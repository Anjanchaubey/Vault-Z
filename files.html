<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>My Files</title>
  <!-- Google Font for a modern look -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <!-- Font Awesome CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <style>
    /* (CSS removed/minimized for brevity) */
     /* Global Styles */
   /* Global Styles */
   * {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
  transition: all 0.3s ease;
}

body {
  font-family: 'Poppins', sans-serif;
  background: linear-gradient(135deg, #e8f0f7, #c9d6e3);
  color: #333;
  padding: 20px;
  min-height: 100vh;
  overflow-x: hidden;
}

h1 {
  text-align: center;
  margin-bottom: 20px;
  font-size: 2rem;
  font-weight: bold;
  color: #2c3e50;
  letter-spacing: 1px;
}

/* Sidebar Styles */
.sidebar {
  position: fixed;
  top: 0;
  left: -220px;
  width: 220px;
  height: 100%;
  background: linear-gradient(135deg, #ffffff, #c9d6e3);
  box-shadow: 0 5px 12px rgba(0, 0, 0, 0.1);
  border-radius: 0 15px 15px 0;
  padding: 20px 18px;
  transition: all 0.4s ease;
  z-index: 1000;
}

.sidebar.open {
  left: 0;
}

.sidebar .profile {
  text-align: center;
  margin-bottom: 25px;
  cursor: pointer;
  transition: transform 0.3s ease;
}

.sidebar .profile:hover {
  transform: scale(1.05);
}

.sidebar .profile img {
  width: 60px;
  height: 60px;
  border-radius: 50%;
  object-fit: cover;
  margin-bottom: 12px;
  border: 3px solid #2196F3;
}

.sidebar .profile h2 {
  font-size: 1.3rem;
  color: #1976D2;
}

.sidebar .profile p {
  font-size: 0.8rem;
  color: #757575;
}

.sidebar .menu {
  display: flex;
  flex-direction: column;
  gap: 15px;
}

.sidebar .menu button {
  width: 100%;
  padding: 10px 20px;
  background: transparent;
  border: none;
  color: #1976D2;
  font-weight: 600;
  cursor: pointer;
  font-size: 1rem;
  transition: all 0.3s ease;
  border-radius: 25px;
  text-align: left;
}

.sidebar .menu button:hover {
  background: rgba(33, 150, 243, 0.1);
  transform: translateX(3px);
}

.sidebar-toggle {
  position: fixed;
  top: 15px;
  left: 15px;
  background: transparent;
  color: #000;
  border: none;
  border-radius: 50%;
  padding: 12px;
  cursor: pointer;
  font-size: 1.4rem;
  transition: background 0.3s ease, transform 0.3s ease;
  z-index: 1100;
}

.sidebar-toggle:hover {
  background: rgba(0, 0, 0, 0.1);
  transform: scale(1.1);
}

/* Main Content Styles */
.main-content {
  margin-left: 50px;
  padding: 15px;
  transition: margin-left 0.4s ease;
}

.search-container {
  display: flex;
  justify-content: center;
  margin-bottom: 20px;
}

.search-container input {
  padding: 10px 15px;
  border: 2px solid #ccc;
  border-radius: 50px;
  font-size: 1rem;
  outline: none;
  width: 180px;
  transition: box-shadow 0.3s ease, border-color 0.3s ease;
}

.search-container input:focus {
  box-shadow: 0 0 8px rgba(52, 152, 219, 0.6);
  border-color: #2196F3;
}

/* File Grid Styles */
.file-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
  gap: 20px;
  margin-top: 20px;
}

.file-item {
  background: #fff;
  border-radius: 12px;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  transition: all 0.3s ease;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  position: relative;

}

.file-item:hover {
  transform: translateY(-5px);
  box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
}

.file-item img,
.file-item embed {
  width: 100%;
  height: 220px;
  object-fit: cover;
  border-bottom: 2px solid #eee;
  border-radius: 12px 12px 0 0;
}

.content {
  padding: 15px;
  text-align: center;
}

.content h3 {
  margin-bottom: 15px;
  font-size: 1.2rem;
  color: #333;
  word-break: break-all;
}

.actions {
  display: flex;
  justify-content: center;
  gap: 15px;
  margin-bottom: 15px;
}

.actions a,
.actions button {
  display: inline-block;
  padding: 8px 16px;
  color: #fff;
  text-decoration: none;
  border-radius: 30px;
  font-weight: bold;
  transition: background 0.3s ease;
  cursor: pointer;
  border: none;
}

.download-btn {
  background: linear-gradient(135deg, #ff6a00, #ee0979);
}

.download-btn:hover {
  background: linear-gradient(135deg, #ee0979, #ff6a00);
}

.delete-btn {
  background: linear-gradient(135deg, #e74c3c, #c0392b);
}

.delete-btn:hover {
  background: linear-gradient(135deg, #c0392b, #e74c3c);
}

/* Favorite Button Styles */
.favorite-btn {
  background: transparent;
  border: none;
  cursor: pointer;
  font-size: 1.4rem;
  color: #f1c40f;
  position: absolute;
  top: 10px;
  right: 10px;
  transition: color 0.3s ease;
}

.favorite-btn.favorited {
  color: #f39c12;
}

/* Responsive adjustments */
@media (max-width: 768px) {
  .file-grid {
    grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
  }
}

@media (max-width: 480px) {
  h1 {
    font-size: 1.8rem;
  }

  .search-container input {
    width: 60%;
  }

  .file-grid {
    grid-template-columns: 1fr;
  }

  .sidebar-toggle {
    left: 10px;
    top: 10px;
    padding: 10px;
  }
}

/* Favorites List Styles */
.favorites-list {
  list-style: none;
  padding: 10px;
  margin: 0;
  display: none;
}

.favorites-list li {
  padding: 8px 15px;
  background: #f9f9f9;
  margin: 8px 0;
  border-radius: 10px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  cursor: pointer;
  transition: background 0.3s ease;
}

.favorites-list li:hover {
  background: #eeeeee;
}

.favorites-list .remove-fav {
  background: none;
  border: none;
  color: #e74c3c;
  font-weight: bold;
  cursor: pointer;
}

/* New Styles */
.header-container {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 30px;
  flex-wrap: wrap;
  gap: 15px;
}

.folder-select-container {
  position: relative;
  margin-left: auto;
}

#folderSelect {
  padding: 10px 35px 10px 18px;
  border: 2px solid #ccc;
  border-radius: 50px;
  font-size: 0.9rem;
  appearance: none;
  background: #fff url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e") no-repeat right 15px center;
  background-size: 18px;
  cursor: pointer;
  transition: all 0.3s ease;
}

#folderSelect:hover {
  border-color: #2196F3;
}

#folderSelect:focus {
  outline: none;
  box-shadow: 0 0 10px rgba(33, 150, 243, 0.3);
}

/* Remove old folder buttons from sidebar */
#generalFolderBtn, #vaultFolderBtn {
  display: none;
}

/* Adjust main content margin */
.main-content {
  margin-left: 50px;
  padding: 15px 30px;
}

@media (max-width: 768px) {
  .header-container {
    flex-direction: column;
    align-items: flex-start;
  }
  
  .folder-select-container {
    width: 100%;
    margin-left: 0;
  }
  
  #folderSelect {
    width: 100%;
  }
}

/* Add these styles */
.empty-state {
  display: none; /* Hidden by default */
  width: 100%;
  text-align: center;
  margin-top: 40px;
}

.empty-state video {
  max-width: 600px; /* Adjust as needed */
  width: 100%;
  height: auto;
  border-radius: 10px;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

.empty-state.visible {
  display: block; /* Show when folder is empty */
}
  </style>
</head>
<body>
  <!-- Sidebar Toggle Button with Font Awesome Icon -->
  <button class="sidebar-toggle" id="sidebarToggle">
    <i class="fa-regular fa-chart-bar"></i>
  </button>
  
  <!-- Sidebar -->
  <div class="sidebar" id="sidebar">
    <div class="profile" id="profileArea">
      <img src="person.png" alt="Profile Picture" id="profilePic">
      <h2 id="profileName">User Name</h2>
      <p id="profileEmail">user@example.com</p>
    </div>
    <div class="menu">
      <!-- Search Bar -->
    <div class="search-container">
      <input type="text" id="searchInput" placeholder="Search files by name..." oninput="filterFiles()">
    </div>
      <button id="favoritesBtn">Favorites</button>
      <button id="allFilesBtn">All Files</button>
      <!-- New Folder Selection Buttons -->
      <button id="generalFolderBtn">General Folder</button>
      <button id="vaultFolderBtn">Personal Vault Folder</button>
      <ul id="favoritesList" class="favorites-list"></ul>
      <button id="deleteAllBtn">Delete All Files</button>
      <a href="index.html">
        <button id="accessFilesBtn" style="background-color: black; padding: 10px; border-radius: 10px; font-family: 'Trebuchet MS', Arial, sans-serif; color: #ddd;">Upload files</button>
      </a>
      <button id="logoutBtn" style="background-color: rgb(215, 29, 29); padding: 10px; border-radius: 10px; font-family: 'Trebuchet MS', Arial, sans-serif; color: #ddd;">Logout</button>
      <a href="about.html">
        <button style="background-color: rgb(204, 229, 20); padding: 10px; border-radius: 10px; font-family: 'Trebuchet MS', Arial, sans-serif; color: #131111;">About</button>
      </a>
    </div>
  </div>
  
  <div class="main-content">
    <!-- Header and search bar -->
    <div class="header-container">
      
      <div class="folder-select-container">
        <select id="folderSelect">
          <option value="general">General Folder</option>
          <option value="personalVault">Personal Vault Folder</option>
        </select>
      </div>
    </div>
  
    
  
    <!-- File Grid -->
    <div class="file-grid" id="fileGrid"></div>
  
    <!-- Empty State Video -->
    <div id="emptyState" class="empty-state">
      <video autoplay loop muted playsinline>
        <source src="empty.mp4" type="video/mp4">
        Your browser does not support the video tag.
      </video>
    </div>
  </div>
  <script type="module">
    // Import and initialize Firebase App
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
    const firebaseConfig = {
      apiKey: "AIzaSyCYY2GQqS0tCXb7Oxw8AWXhpexq9e8VRUs",
      authDomain: "aspirehub-32863.firebaseapp.com",
      projectId: "aspirehub-32863",
      storageBucket: "aspirehub-32863.appspot.com",
      messagingSenderId: "686810111182",
      appId: "1:686810111182:web:4290b4b1b6e64934ec449f",
      measurementId: "G-KX41R0SSMY"
    };
    const app = initializeApp(firebaseConfig);
  
    // Import Firebase services
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";
    import { getStorage, ref, listAll, getDownloadURL, deleteObject, getMetadata } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-storage.js";
    import { getFirestore } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";
  
    const auth = getAuth(app);
    const storage = getStorage(app);
    const db = getFirestore(app);
  
    // Favorites handling
    let favoritesSet = new Set(JSON.parse(localStorage.getItem("favorites") || "[]"));
    let isFavoritesMode = false;
    let allFiles = []; // Store all files here
    let currentBatch = 0; // Track current batch
    const batchSize = 10; // Number of files to load per batch
    let selectedFolder = "general";
  
    function saveFavorites() {
      localStorage.setItem("favorites", JSON.stringify(Array.from(favoritesSet)));
    }
  
    // Sidebar toggle
    const sidebarToggle = document.getElementById('sidebarToggle');
    const sidebar = document.getElementById('sidebar');
    sidebarToggle.addEventListener('click', () => {
      sidebar.classList.toggle('open');
    });
  
    // Folder selection dropdown
    const folderSelect = document.getElementById('folderSelect');
    folderSelect.addEventListener('change', async (e) => {
      const newFolder = e.target.value;
  
      if (newFolder === 'personalVault') {
        const enteredPassword = prompt("Enter password for Personal Vault:");
        if (enteredPassword !== "anjan@2007") {
          alert("Incorrect password. Access denied.");
          e.target.value = selectedFolder; // Reset to previous value
          return;
        }
      }
  
      selectedFolder = newFolder;
      await loadFiles(auth.currentUser.uid, selectedFolder);
    });
  
    // Sidebar buttons
    const favoritesBtn = document.getElementById('favoritesBtn');
    const allFilesBtn = document.getElementById('allFilesBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const deleteAllBtn = document.getElementById('deleteAllBtn');
  
    favoritesBtn.addEventListener('click', () => {
      isFavoritesMode = true;
      filterFiles();
      sidebar.classList.remove('open');
    });
  
    allFilesBtn.addEventListener('click', () => {
      isFavoritesMode = false;
      filterFiles();
      sidebar.classList.remove('open');
    });
  
    // Logout functionality
    logoutBtn.addEventListener('click', async () => {
      try {
        await signOut(auth);
        window.location.href = 'index.html';
      } catch (error) {
        console.error('Logout Error:', error);
        alert('Error logging out. Please try again.');
      }
    });
  
    // Delete All Files functionality
    deleteAllBtn.addEventListener('click', async () => {
      const password = prompt("Enter password to delete all files:");
      if (password !== "anjan@2007") {
        alert("Incorrect password!");
        return;
      }
      const user = auth.currentUser;
      if (!user) {
        alert("No user signed in!");
        return;
      }
      if (confirm("Are you sure you want to delete ALL your files from the currently selected folder?")) {
        try {
          const folderRef = ref(storage, `users/${user.uid}/files/${selectedFolder}`);
          const result = await listAll(folderRef);
          const deletePromises = result.items.map(item => deleteObject(item));
          await Promise.all(deletePromises);
          alert("All files in the folder deleted successfully!");
          loadFiles(user.uid, selectedFolder);
        } catch (error) {
          console.error("Error deleting all files:", error);
          alert("Error deleting files. Please try again.");
        }
      }
      await Promise.all(deletePromises);
    await loadFiles(user.uid, selectedFolder); // This will automatically show the empty state
  });
  
    // Auth state listener
    onAuthStateChanged(auth, async (user) => {
      if (!user) {
        alert('Please sign in first!');
        window.location.href = 'index.html';
        return;
      }
  
      // Set initial folder selection
      folderSelect.value = selectedFolder;
      document.getElementById('profileEmail').textContent = user.email;
      document.getElementById('profileName').textContent = user.displayName || "User Name";
      if (user.photoURL) {
        document.getElementById('profilePic').src = user.photoURL;
      }
      document.getElementById('searchInput').addEventListener('input', filterFiles);
      await loadFiles(user.uid, selectedFolder);
    });
  
    // Load files from Firebase Storage in batches
    async function loadFiles(userId, folder = "general") {
    const storageRef = ref(storage, `users/${userId}/files/${folder}`);
    try {
      const fileListResult = await listAll(storageRef);
      allFiles = fileListResult.items;
      currentBatch = 0;
      
      // Clear existing files
      const fileGrid = document.getElementById('fileGrid');
      fileGrid.innerHTML = '';
      
      // Show/hide empty state
      const emptyState = document.getElementById('emptyState');
      if (allFiles.length === 0) {
        emptyState.classList.add('visible');
        // Get the empty.mp4 video URL from storage
        const videoRef = ref(storage, 'public/empty.mp4');
        const videoUrl = await getDownloadURL(videoRef);
        emptyState.querySelector('video').src = videoUrl;
      } else {
        emptyState.classList.remove('visible');
        await renderNextBatch();
      }
    } catch (error) {
      console.error("Error listing files:", error);
     
    }
  }

  
    // Render the next batch of files
    async function renderNextBatch() {
      const fileGrid = document.getElementById('fileGrid');
      const start = currentBatch * batchSize;
      const end = start + batchSize;
      const batchFiles = allFiles.slice(start, end);
  
      for (const item of batchFiles) {
        const url = await getDownloadURL(item);
        const metadata = await getMetadata(item);
        const fileItemElement = createFileItemElement(item.name, url, metadata);
        fileGrid.appendChild(fileItemElement);
      }
  
      currentBatch++;
  
      // Show/hide the "Load More" button
      const loadMoreBtn = document.getElementById('loadMoreBtn');
      if (end < allFiles.length) {
        loadMoreBtn.style.display = "block";
      } else {
        loadMoreBtn.style.display = "none";
      }
    }
  
    // Event listener for the "Load More" button
    document.getElementById('loadMoreBtn').addEventListener('click', async () => {
      await renderNextBatch();
    });
  
    // Create file item element
    function createFileItemElement(name, url, metadata) {
      const fileItem = document.createElement('div');
      fileItem.className = 'file-item';
      fileItem.setAttribute("data-filename", name.toLowerCase());
  
      // Favorite star icon
      const favBtn = document.createElement('button');
      favBtn.className = 'favorite-btn';
      if (favoritesSet.has(name)) {
        favBtn.classList.add('favorited');
        favBtn.innerHTML = '<i class="fa-solid fa-star"></i>';
      } else {
        favBtn.innerHTML = '<i class="fa-regular fa-star"></i>';
      }
      favBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        if (favoritesSet.has(name)) {
          favoritesSet.delete(name);
          favBtn.classList.remove('favorited');
          favBtn.innerHTML = '<i class="fa-regular fa-star"></i>';
        } else {
          favoritesSet.add(name);
          favBtn.classList.add('favorited');
          favBtn.innerHTML = '<i class="fa-solid fa-star"></i>';
        }
        saveFavorites();
        if (isFavoritesMode) filterFiles();
      });
      fileItem.appendChild(favBtn);
  
      // File preview with lazy loading
      if (name.match(/\.(jpg|jpeg|png|gif)$/i)) {
        const img = document.createElement('img');
        img.src = url;
        img.alt = name;
        img.loading = "lazy"; // Lazy loading for images
        fileItem.appendChild(img);
      } else if (name.match(/\.pdf$/i)) {
        const embed = document.createElement('embed');
        embed.src = url;
        embed.type = 'application/pdf';
        fileItem.appendChild(embed);
      }
  
      // Content container
      const content = document.createElement('div');
      content.className = 'content';
  
      // File name
      const fileName = document.createElement('h3');
      fileName.textContent = name;
      content.appendChild(fileName);
  
      // Action buttons
      const actions = document.createElement('div');
      actions.className = 'actions';
  
      // Download button
      const downloadBtn = document.createElement('a');
      downloadBtn.className = 'download-btn';
      downloadBtn.href = url;
      downloadBtn.download = true;
      downloadBtn.textContent = name.match(/\.pdf$/i) ? 'Download PDF' : 'Download';
  
      // Delete button
      const deleteBtn = document.createElement('button');
      deleteBtn.className = 'delete-btn';
      deleteBtn.textContent = 'Delete';
      deleteBtn.addEventListener('click', () => handleDeleteFile(name));
  
      actions.appendChild(downloadBtn);
      actions.appendChild(deleteBtn);
      content.appendChild(actions);
      fileItem.appendChild(content);
  
      return fileItem;
    }
  
    // Delete single file
    async function handleDeleteFile(fileName) {
      const user = auth.currentUser;
      if (!user) return;
      if (confirm(`Are you sure you want to delete "${fileName}"?`)) {
        try {
          const fileRef = ref(storage, `users/${user.uid}/files/${selectedFolder}/${fileName}`);
          await deleteObject(fileRef);
          if (favoritesSet.has(fileName)) {
            favoritesSet.delete(fileName);
            saveFavorites();
          }
          await loadFiles(user.uid, selectedFolder);
          alert('File deleted successfully!');
        } catch (error) {
          console.error("Error deleting file:", error);
          alert("Error deleting file. Please try again.");
        }
      }
    }
  
    // Filter files
    function filterFiles() {
      const query = document.getElementById('searchInput').value.trim().toLowerCase();
      const fileItems = document.querySelectorAll('.file-item');
      fileItems.forEach(item => {
        const fileName = item.getAttribute('data-filename');
        let visible = fileName.includes(query);
        if (isFavoritesMode) {
          visible = visible && favoritesSet.has(fileName);
        }
        item.style.display = visible ? "" : "none";
      });
    }
  </script>
  

</body>
</html>
